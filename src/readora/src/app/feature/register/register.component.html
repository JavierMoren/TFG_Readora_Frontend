<!-- filepath: /home/javier/Documentos/Escolar/TFG/Proyecto_TFG/TFG_Readora_Frontend/src/readora/src/app/feature/register/register.component.html -->
<div class="container min-vh-100 d-flex align-items-center justify-content-center py-5">
  <div class="col-12 col-md-8 col-lg-7 col-xl-6">
    <div class="text-center mb-4">
      <img src="assets/logos/Logo.svg" alt="Logo Readora" class="auth-logo mb-3">
      <h1 class="h2 fw-bold text-highlight">Únete a Readora</h1>
      <p class="text-secondary small">Crea tu cuenta y comienza a gestionar tu biblioteca personal</p>
    </div>

    <div class="card shadow border-0 auth-card">
      <div class="card-body p-0">
        
        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="auth-form p-4">
          <div class="row">            <div class="col-md-6 mb-4">
              <label for="usuario" class="form-label fw-medium">Usuario <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="material-icons small">account_circle</i></span>
                <input 
                  type="text" 
                  id="usuario" 
                  formControlName="usuario"
                  class="form-control border-start-0"
                  [ngClass]="{'is-invalid': registerForm.get('usuario')?.invalid && (registerForm.get('usuario')?.touched || formularioEnviado), 
                             'is-valid': usuarioValido && registerForm.get('usuario')?.touched}"
                  placeholder="Elige un nombre de usuario">
                <div *ngIf="usuarioVerificandose" class="spinner-border spinner-border-sm text-primary position-absolute end-0 top-50 translate-middle-y me-3" role="status">
                  <span class="visually-hidden">Verificando...</span>
                </div>
                <div *ngIf="usuarioValido && !usuarioVerificandose && registerForm.get('usuario')?.touched" class="valid-feedback position-absolute end-0 top-50 translate-middle-y me-3">
                  <i class="material-icons text-success small">check_circle</i>
                </div>
              </div>
              <div *ngIf="registerForm.get('usuario')?.invalid && (registerForm.get('usuario')?.touched || formularioEnviado)" class="invalid-feedback d-block small mt-1">
                {{ getErrorMessage('usuario') }}
              </div>
            </div>            <div class="col-md-6 mb-4">
              <label for="gmail" class="form-label fw-medium">Correo electrónico <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="material-icons small">mail</i></span>
                <input 
                  type="email" 
                  id="gmail" 
                  formControlName="gmail"
                  class="form-control border-start-0"
                  [ngClass]="{'is-invalid': registerForm.get('gmail')?.invalid && (registerForm.get('gmail')?.touched || formularioEnviado), 
                             'is-valid': gmailValido && registerForm.get('gmail')?.touched}"
                  placeholder="Ingresa tu correo electrónico">
                <!-- Solo mostrar el spinner mientras se valida -->
                <output *ngIf="gmailVerificandose" class="spinner-border spinner-border-sm text-primary position-absolute end-0 top-50 translate-middle-y me-3">
                  <span class="visually-hidden">Verificando...</span>
                </output>
                <!-- Solo mostrar el check si es válido y no se está validando -->
                <div *ngIf="!gmailVerificandose && gmailValido && registerForm.get('gmail')?.touched" class="valid-feedback position-absolute end-0 top-50 translate-middle-y me-3">
                  <i class="material-icons text-success small">check_circle</i>
                </div>
              </div>
              <!-- Solo mostrar el mensaje de error si es inválido y no se está validando -->
              <div *ngIf="!gmailVerificandose && registerForm.get('gmail')?.invalid && (registerForm.get('gmail')?.touched || formularioEnviado)" class="invalid-feedback d-block small mt-1">
                {{ getErrorMessage('gmail') }}
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <label for="nombre" class="form-label fw-medium">Nombre <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="material-icons small">badge</i></span>
                <input 
                  type="text" 
                  id="nombre" 
                  formControlName="nombre"
                  class="form-control border-start-0"
                  [ngClass]="{'is-invalid': registerForm.get('nombre')?.invalid && (registerForm.get('nombre')?.touched || registerForm.get('nombre')?.dirty)}"
                  placeholder="Ingresa tu nombre">
              </div>
              <div *ngIf="registerForm.get('nombre')?.invalid && (registerForm.get('nombre')?.touched || registerForm.get('nombre')?.dirty)" class="invalid-feedback d-block small mt-1">
                {{ getErrorMessage('nombre') }}
              </div>
            </div>

            <div class="col-md-6 mb-4">
              <label for="apellido" class="form-label fw-medium">Apellido <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="material-icons small">badge</i></span>
                <input 
                  type="text" 
                  id="apellido" 
                  formControlName="apellido"
                  class="form-control border-start-0"
                  [ngClass]="{'is-invalid': registerForm.get('apellido')?.invalid && (registerForm.get('apellido')?.touched || registerForm.get('apellido')?.dirty)}"
                  placeholder="Ingresa tu apellido">
              </div>
              <div *ngIf="registerForm.get('apellido')?.invalid && (registerForm.get('apellido')?.touched || registerForm.get('apellido')?.dirty)" class="invalid-feedback d-block small mt-1">
                {{ getErrorMessage('apellido') }}
              </div>
            </div>

            <div class="col-12 mb-4">
              <label for="contrasenna" class="form-label fw-medium">Contraseña <span class="text-danger">*</span></label>
              <div class="input-group">
                <span class="input-group-text bg-light border-end-0"><i class="material-icons small">lock</i></span>
                <input 
                  type="password" 
                  id="contrasenna" 
                  formControlName="contrasenna"
                  class="form-control border-start-0"
                  [ngClass]="{'is-invalid': registerForm.get('contrasenna')?.invalid && (registerForm.get('contrasenna')?.touched || registerForm.get('contrasenna')?.dirty)}"
                  placeholder="Crea una contraseña segura (mínimo 6 caracteres)">
              </div>
              <div *ngIf="registerForm.get('contrasenna')?.invalid && (registerForm.get('contrasenna')?.touched || registerForm.get('contrasenna')?.dirty)" class="invalid-feedback d-block small mt-1">
                {{ getErrorMessage('contrasenna') }}
              </div>
              <small class="form-text text-muted mt-2">
                <i class="material-icons small align-middle">info</i>
                La contraseña debe tener al menos 6 caracteres. Te recomendamos usar letras, números y símbolos.
              </small>
            </div>
          </div>          <button 
            type="submit" 
            [disabled]="registerForm.invalid || registerForm.pending || usuarioVerificandose || gmailVerificandose"
            class="btn btn-primary w-100 py-2 mb-3 auth-btn mt-2">
            <span class="d-flex align-items-center justify-content-center">
              <i class="material-icons me-2">how_to_reg</i>
              <span *ngIf="!registerForm.pending && !usuarioVerificandose && !gmailVerificandose">Crear cuenta</span>
              <span *ngIf="registerForm.pending || usuarioVerificandose || gmailVerificandose">
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                Verificando...
              </span>
            </span>
          </button>
          
          <!-- Separador visual para OAuth2 -->
          <div class="d-flex align-items-center my-4">
            <hr class="flex-grow-1 border-secondary opacity-25">
            <span class="px-3 text-secondary small">O</span>
            <hr class="flex-grow-1 border-secondary opacity-25">
          </div>
          <a 
            (click)="loginWithGoogle()"
            class="btn btn-outline-secondary w-100 py-2 mb-3 d-block"
            style="cursor:pointer;"
            aria-label="Registrarse con Google">
            <span class="d-flex align-items-center justify-content-center">
              <img src="assets/logos/google-logo.svg" alt="Logo de Google" class="me-2" width="20" height="20">
              Registrarse con Google
            </span>
          </a>
          <!-- Fin OAuth2 -->

          <!-- Enlace para usuarios ya registrados -->
          <div class="text-center mt-4">
            <p class="mb-0">
              <a routerLink="/api/v1/authenticate" class="text-primary text-decoration-none auth-link" aria-label="Ir a la página de inicio de sesión">
                ¿Ya tienes cuenta? <span class="fw-medium">Inicia sesión aquí</span>
              </a>
            </p>
          </div>
        </form>
      </div>
    </div>
    
    <div class="text-center mt-4">
      <a routerLink="/" class="d-inline-flex align-items-center text-primary text-decoration-none transition-all">
        <span class="material-icons small me-1">arrow_back</span>
        <span>Volver al inicio</span>
      </a>
    </div>
  </div>
</div>
