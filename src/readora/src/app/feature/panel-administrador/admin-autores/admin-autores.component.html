<div class="mb-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-3">
    <h2 class="h5 fw-medium text-highlight mb-0">Gestión de Autores</h2>
    
    <div class="d-flex flex-wrap gap-2">
      <!-- Botón para añadir nuevo autor -->
      <button *ngIf="!showForm" (click)="prepareCreateAutor()" 
        class="btn btn-primary btn-sm d-inline-flex align-items-center transition-all">
        <span class="material-icons small me-1">add</span>
        <span>Añadir Autor</span>
      </button>
    </div>
  </div>

  <!-- Formulario para añadir/editar autor -->
  <div *ngIf="showForm" class="card shadow-sm border-0 mb-4">
    <div class="card-header d-flex justify-content-between align-items-center border-bottom">
      <h3 class="h6 fw-medium text-highlight mb-0">{{isEditing ? 'Editar Autor' : 'Añadir Autor'}}</h3>
      <button (click)="cancelEdit()" class="btn-close btn-sm" aria-label="Cerrar"></button>
    </div>
    
    <div class="card-body">
      <form (submit)="saveAutor()" #autorForm="ngForm" class="mb-3">
        <div class="row mb-3">
          <div class="col-12 col-md-6 mb-3 mb-md-0">
            <label for="nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text">
                <span class="material-icons small">person</span>
              </span>
              <input type="text" id="nombre" [(ngModel)]="currentAutor.nombre" name="nombre" 
                class="form-control" 
                required
                #nombreInput="ngModel"
                [ngClass]="{'is-invalid': nombreInput.invalid && (nombreInput.dirty || nombreInput.touched)}">
            </div>
            <div *ngIf="nombreInput.invalid && (nombreInput.dirty || nombreInput.touched)" class="text-danger small mt-1">
              <span *ngIf="nombreInput.errors?.['required']">El nombre es obligatorio</span>
            </div>
          </div>
          
          <div class="col-12 col-md-6">
            <label for="apellido" class="form-label">Apellido <span class="text-danger">*</span></label>
            <div class="input-group">
              <span class="input-group-text">
                <span class="material-icons small">person</span>
              </span>
              <input type="text" id="apellido" [(ngModel)]="currentAutor.apellido" name="apellido" 
                class="form-control" 
                required
                #apellidoInput="ngModel"
                [ngClass]="{'is-invalid': apellidoInput.invalid && (apellidoInput.dirty || apellidoInput.touched)}">
            </div>
            <div *ngIf="apellidoInput.invalid && (apellidoInput.dirty || apellidoInput.touched)" class="text-danger small mt-1">
              <span *ngIf="apellidoInput.errors?.['required']">El apellido es obligatorio</span>
            </div>
          </div>
        </div>
        
        <div class="row mb-3">
          <div class="col-12 col-md-6 mb-3 mb-md-0">
            <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
            <div class="input-group">
              <span class="input-group-text">
                <span class="material-icons small">event</span>
              </span>
              <input type="date" id="fechaNacimiento" [(ngModel)]="currentAutor.fechaNacimiento" name="fechaNacimiento" 
                class="form-control">
            </div>
          </div>
          
          <div class="col-12 col-md-6">
            <label for="fechaFallecimiento" class="form-label">Fecha de Fallecimiento</label>
            <div class="input-group">
              <span class="input-group-text">
                <span class="material-icons small">event</span>
              </span>
              <input type="date" id="fechaFallecimiento" [(ngModel)]="currentAutor.fechaFallecimiento" name="fechaFallecimiento" 
                class="form-control">
            </div>
          </div>
        </div>
        
        <div class="mb-3">
          <label for="biografia" class="form-label">Biografía</label>
          <textarea id="biografia" [(ngModel)]="currentAutor.biografia" name="biografia" 
            class="form-control" rows="3"></textarea>
        </div>
        
        <div class="col-12">
          <label for="foto" class="form-label">Fotografía</label>
          <div class="d-flex gap-3 align-items-start">
            <!-- Vista previa de la imagen actual si existe -->
            <div *ngIf="previewImageUrl" class="mb-2" style="max-width: 150px;">
              <img [src]="previewImageUrl" alt="Vista previa" class="img-fluid rounded">
            </div>
            <div class="flex-grow-1">
              <input type="file" class="form-control" id="foto" (change)="onFileSelected($event)" accept="image/*">
              <small class="text-muted">Formatos aceptados: JPG, PNG (Máx. 2 MB)</small>
            </div>
          </div>
        </div>
        
        <div class="d-flex gap-2 mt-4">
          <button type="submit" [disabled]="autorForm.invalid || isUploading"
            class="btn btn-primary btn-sm d-inline-flex align-items-center transition-all">
            <span class="material-icons small me-1">save</span>
            <span *ngIf="!isUploading">Guardar</span>
            <span *ngIf="isUploading">Guardando...</span>
          </button>
          <button type="button" (click)="cancelEdit()" 
            class="btn btn-outline-secondary btn-sm d-inline-flex align-items-center transition-all">
            <span class="material-icons small me-1">close</span>
            <span>Cancelar</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Visualización de autores en tarjetas -->
  <div class="row g-3">
    <div *ngFor="let autor of displayedAutores" class="col-12 col-sm-6 col-md-4 col-lg-3">
      <div class="card h-100 shadow-sm transition-all">
        <div class="ratio ratio-4x3">
          <img 
            [src]="getImageUrl(autor.fotoUrl)" 
            class="card-img-top object-fit-cover"
            alt="{{autor.nombre}} {{autor.apellido}}">
        </div>
        <div class="card-body">
          <h5 class="card-title fw-bold">{{autor.nombre}} {{autor.apellido}}</h5>
          <p class="card-text small text-muted mb-2">
            <span *ngIf="autor.fechaNacimiento">{{autor.fechaNacimiento | date:'yyyy'}}</span>
            <span *ngIf="autor.fechaNacimiento && autor.fechaFallecimiento"> - </span>
            <span *ngIf="autor.fechaFallecimiento">{{autor.fechaFallecimiento | date:'yyyy'}}</span>
          </p>
          <p class="card-text small text-truncate">{{autor.biografia || 'Sin biografía'}}</p>
        </div>
        <div class="card-footer bg-transparent border-top">
          <div class="d-flex justify-content-end gap-2">
            <button (click)="prepareUpdateAutor(autor)" 
              class="btn btn-sm btn-outline-primary" title="Editar">
              <span class="material-icons small">edit</span>
            </button>
            <button (click)="deleteAutor(autor.id)" 
              class="btn btn-sm btn-outline-danger" title="Eliminar">
              <span class="material-icons small">delete</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mensaje cuando no hay autores -->
    <div *ngIf="displayedAutores.length === 0" class="col-12">
      <div class="alert alert-info text-center">
        No hay autores disponibles
      </div>
    </div>
  </div>
  
  <!-- Paginación -->
  <nav *ngIf="autores.length > 0" class="d-flex justify-content-center mt-4">
    <ul class="pagination pagination-sm">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" href="javascript:void(0)" (click)="prevPage()" aria-label="Anterior">
          <span aria-hidden="true"><</span>
        </a>
      </li>
      <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index" [class.active]="currentPage === i + 1">
        <a class="page-link" href="javascript:void(0)" (click)="currentPage = i + 1; updateDisplayedAutores()">
          {{i + 1}}
        </a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" href="javascript:void(0)" (click)="nextPage()" aria-label="Siguiente">
          <span aria-hidden="true">></span>
        </a>
      </li>
    </ul>
  </nav>
</div>
